<Window x:Class="Pw.Hub.Windows.ModuleEditorWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:sys="clr-namespace:System;assembly=mscorlib"
        Title="Модуль" Height="600" Width="800" WindowStartupLocation="CenterOwner"
        Icon="/Assets/icon.png"
        Style="{StaticResource ModernWindowChrome}">
    <Grid Margin="16">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- Header -->
        <Border Grid.Row="0"
                Style="{StaticResource Panel}"
                Margin="0,0,0,16">
            <TextBlock Text="⚙ Редактор модуля"
                      Style="{StaticResource HeaderMedium}"
                      Margin="0"/>
        </Border>

        <!-- Content -->
        <ScrollViewer Grid.Row="1"
                     VerticalScrollBarVisibility="Auto"
                     Margin="0,0,0,16">
            <StackPanel>
                <!-- Basic info card -->
                <Border Style="{StaticResource Card}">
                    <StackPanel>
                        <TextBlock Text="Основная информация"
                                  Style="{StaticResource HeaderSmall}"/>

                        <TextBlock Text="Название"
                                  Style="{StaticResource ModernTextBlock}"
                                  Margin="0,0,0,6"/>
                        <TextBox x:Name="NameTextBox"
                                Style="{StaticResource ModernTextBox}"
                                Padding="12,10"
                                Margin="0,0,0,16"/>

                        <TextBlock Text="Описание"
                                  Style="{StaticResource ModernTextBlock}"
                                  Margin="0,0,0,6"/>
                        <TextBox x:Name="DescriptionTextBox"
                                Style="{StaticResource ModernTextBox}"
                                Padding="12,10"
                                Margin="0,0,0,16"/>

                        <TextBlock Text="Скрипт"
                                  Style="{StaticResource ModernTextBlock}"
                                  Margin="0,0,0,6"/>
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="Auto"/>
                            </Grid.ColumnDefinitions>
                            <TextBox x:Name="ScriptTextBox"
                                    Style="{StaticResource ModernTextBox}"
                                    Padding="12,10"
                                    Grid.Column="0"
                                    Margin="0,0,8,0"/>
                            <Button Grid.Column="1"
                                   Style="{StaticResource ModernButton}"
                                   Content="📁"
                                   Width="44"
                                   Padding="8"
                                   Click="BrowseScript_Click"/>
                        </Grid>
                    </StackPanel>
                </Border>

                <!-- Parameters card -->
                <Border Style="{StaticResource Card}">
                    <DockPanel>
                        <StackPanel DockPanel.Dock="Top" Margin="0,0,0,12">
                            <TextBlock Text="Входные параметры"
                                      Style="{StaticResource HeaderSmall}"/>
                        </StackPanel>
                        <StackPanel Orientation="Horizontal"
                                   DockPanel.Dock="Top"
                                   HorizontalAlignment="Right"
                                   Margin="0,0,0,12">
                            <Button x:Name="AddInputButton"
                                   Style="{StaticResource PrimaryButton}"
                                   Content="➕ Добавить"
                                   MinWidth="120"
                                   Padding="12,8"
                                   Margin="0,0,8,0"
                                   Click="AddInput_Click"/>
                            <Button x:Name="RemoveInputButton"
                                   Style="{StaticResource ModernButton}"
                                   Content="🗑 Удалить"
                                   MinWidth="120"
                                   Padding="12,8"
                                   Click="RemoveInput_Click"/>
                        </StackPanel>
                        <DataGrid x:Name="InputsGrid"
                                 Style="{StaticResource ModernDataGrid}"
                                 AutoGenerateColumns="False"
                                 CanUserAddRows="False"
                                 SelectionMode="Single"
                                 MinHeight="200">
                            <DataGrid.Columns>
                                <DataGridTextColumn Header="Name" Binding="{Binding Name}" Width="*" MinWidth="180">
                                    <DataGridTextColumn.EditingElementStyle>
                                        <Style TargetType="TextBox" BasedOn="{StaticResource ModernTextBox}">
                                            <Setter Property="Background" Value="{StaticResource BackgroundSecondaryBrush}"/>
                                            <Setter Property="Foreground" Value="{StaticResource TextPrimaryBrush}"/>
                                            <Setter Property="BorderThickness" Value="0"/>
                                            <Setter Property="Padding" Value="8,6"/>
                                            <Setter Property="MinHeight" Value="32"/>
                                        </Style>
                                    </DataGridTextColumn.EditingElementStyle>
                                </DataGridTextColumn>
                                <DataGridTextColumn Header="Label" Binding="{Binding Label}" Width="*" MinWidth="200">
                                    <DataGridTextColumn.EditingElementStyle>
                                        <Style TargetType="TextBox" BasedOn="{StaticResource ModernTextBox}">
                                            <Setter Property="Background" Value="{StaticResource BackgroundSecondaryBrush}"/>
                                            <Setter Property="Foreground" Value="{StaticResource TextPrimaryBrush}"/>
                                            <Setter Property="BorderThickness" Value="0"/>
                                            <Setter Property="Padding" Value="8,6"/>
                                            <Setter Property="MinHeight" Value="32"/>
                                        </Style>
                                    </DataGridTextColumn.EditingElementStyle>
                                </DataGridTextColumn>
                                <DataGridComboBoxColumn Header="Type" SelectedItemBinding="{Binding Type}" Width="120">
                                    <DataGridComboBoxColumn.ItemsSource>
                                        <x:Array Type="{x:Type sys:String}">
                                            <sys:String>string</sys:String>
                                            <sys:String>number</sys:String>
                                            <sys:String>bool</sys:String>
                                        </x:Array>
                                    </DataGridComboBoxColumn.ItemsSource>
                                    <DataGridComboBoxColumn.EditingElementStyle>
                                        <Style TargetType="ComboBox" BasedOn="{StaticResource ModernComboBox}">
                                            <Setter Property="Background" Value="{StaticResource BackgroundSecondaryBrush}"/>
                                            <Setter Property="Foreground" Value="{StaticResource TextPrimaryBrush}"/>
                                            <Setter Property="BorderThickness" Value="0"/>
                                        </Style>
                                    </DataGridComboBoxColumn.EditingElementStyle>
                                    <DataGridComboBoxColumn.ElementStyle>
                                        <Style TargetType="ComboBox" BasedOn="{StaticResource ModernComboBox}">
                                            <Setter Property="Background" Value="Transparent"/>
                                            <Setter Property="Foreground" Value="{StaticResource TextPrimaryBrush}"/>
                                            <Setter Property="BorderThickness" Value="0"/>
                                        </Style>
                                    </DataGridComboBoxColumn.ElementStyle>
                                </DataGridComboBoxColumn>
                                <DataGridTextColumn Header="Default" Binding="{Binding Default}" Width="*">
                                    <DataGridTextColumn.EditingElementStyle>
                                        <Style TargetType="TextBox" BasedOn="{StaticResource ModernTextBox}">
                                            <Setter Property="Background" Value="{StaticResource BackgroundSecondaryBrush}"/>
                                            <Setter Property="Foreground" Value="{StaticResource TextPrimaryBrush}"/>
                                            <Setter Property="BorderThickness" Value="0"/>
                                            <Setter Property="Padding" Value="8,6"/>
                                            <Setter Property="MinHeight" Value="32"/>
                                        </Style>
                                    </DataGridTextColumn.EditingElementStyle>
                                </DataGridTextColumn>
                                <DataGridCheckBoxColumn Header="Required" Binding="{Binding Required}" Width="90">
                                    <DataGridCheckBoxColumn.ElementStyle>
                                        <Style TargetType="CheckBox">
                                            <Setter Property="HorizontalAlignment" Value="Center"/>
                                            <Setter Property="VerticalAlignment" Value="Center"/>
                                            <Setter Property="Background" Value="Transparent"/>
                                            <Setter Property="Foreground" Value="{StaticResource TextPrimaryBrush}"/>
                                            <Setter Property="BorderBrush" Value="{StaticResource BorderBrush}"/>
                                        </Style>
                                    </DataGridCheckBoxColumn.ElementStyle>
                                </DataGridCheckBoxColumn>
                            </DataGrid.Columns>
                        </DataGrid>
                    </DockPanel>
                </Border>
            </StackPanel>
        </ScrollViewer>

        <!-- Actions -->
        <StackPanel Grid.Row="2"
                   Orientation="Horizontal"
                   HorizontalAlignment="Right">
            <Button Style="{StaticResource ModernButton}"
                   Content="Отмена"
                   MinWidth="120"
                   Padding="16,10"
                   Margin="0,0,8,0"
                   IsCancel="True"/>
            <Button Style="{StaticResource PrimaryButton}"
                   Content="Сохранить"
                   MinWidth="120"
                   Padding="16,10"
                   IsDefault="True"
                   Click="Ok_Click"/>
        </StackPanel>
    </Grid>
</Window>